<!doctype html>
<html lang="nb">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard – Prioriteringsøvelse</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="config.js"></script>

  <style>
    :root {
      --bg:#f5f6f7;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --blue:#2563eb;
    }

    * { box-sizing:border-box; }
    body {
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }

    header {
      background:#0f172a;
      color:#fff;
      padding:14px 18px;
    }
    header h1 { margin:0; font-size:18px; font-weight:600; }

    main { padding:16px; }

    .card {
      background:var(--card);
      border-radius:10px;
      padding:14px;
      box-shadow:0 6px 16px rgba(0,0,0,.08);
      margin-bottom:16px;
    }

    .row { display:flex; gap:16px; align-items:flex-start; }
    .col { flex:1; min-width:0; }

    h2 { margin:0 0 6px; font-size:16px; }
    .muted { color:var(--muted); font-size:12px; }

    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px; border-bottom:1px solid var(--border); text-align:left; }
    th { font-size:12px; color:var(--muted); font-weight:600; }

    pre {
      white-space:pre-wrap;
      font-size:12px;
      background:#f8fafc;
      padding:10px;
      border-radius:8px;
      border:1px solid var(--border);
      margin:0;
    }

    button {
      border:0;
      border-radius:8px;
      padding:8px 12px;
      cursor:pointer;
      background:var(--blue);
      color:#fff;
      font-size:13px;
    }

    .pill {
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      background:#e5e7eb;
      font-size:11px;
      margin-left:6px;
    }

    ul { margin:8px 0 0 18px; }
  </style>
</head>

<body>
<header>
  <h1>Dashboard – Prioriteringsøvelse</h1>
</header>

<main>

  <div class="card">
    <div class="muted">
      Viser aggregert oversikt over innsendte prioriteringer.
      Dette er en prioriteringsøvelse (ikke en evaluering av enkeltpersoner).
    </div>
    <div style="margin-top:8px;">
      Scenario-ID: <span class="pill" id="scenarioIdPill">–</span>
    </div>
  </div>

  <!-- ALWAYS VISIBLE: CONTEXT DONUTS -->
  <div class="row">
    <div class="col card">
      <h2>Fordeling av midler</h2>
      <div class="muted">Låst (stat) vs fleksibelt (handlingsrom).</div>
      <canvas id="chartFundsPie"></canvas>
      <div class="muted" id="fundsText" style="margin-top:8px;"></div>
    </div>

    <div class="col card">
      <h2>Fordeling av personellkapasitet</h2>
      <div class="muted">Basert på registrert kapasitet per person (capacity_pct).</div>
      <canvas id="chartPeoplePie"></canvas>
      <div class="muted" id="peopleText" style="margin-top:8px;"></div>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="row" style="margin-top:16px;">
    <div class="col card">
      <h2>Topp oppgaver (tid)</h2>
      <div class="muted">Summert over alle innsendinger.</div>
      <canvas id="chartTime"></canvas>
    </div>
    <div class="col card">
      <h2>Topp oppgaver (handlingsrom – NOK)</h2>
      <div class="muted">Kun fleksible midler (handlingsrom) teller her.</div>
      <canvas id="chartMoney"></canvas>
    </div>
  </div>

  <!-- IGNORED TASKS + SUBMISSIONS -->
  <div class="row" style="margin-top:16px;">
    <div class="col card">
      <h2>Oppgaver uten dekning</h2>
      <div class="muted">Oppgaver uten både tid og midler (handlingsrom) på tvers av innsendinger.</div>
      <div id="ignoredTasks">(laster...)</div>
    </div>

    <div class="col card">
      <h2>Innsendinger</h2>
      <div class="muted">Klikk «Vis» for å se logg (brukes primært for kvalitetssjekk).</div>
      <div id="submissions">(laster...)</div>
      <button id="exportCsv" style="margin-top:10px;">Eksporter aggregert CSV</button>
    </div>
  </div>

  <div class="card">
    <h2>Valgt logg</h2>
    <pre id="logView">(velg en innsending)</pre>
  </div>

</main>

<script src="dashboard.js"></script>
</body>
</html>
